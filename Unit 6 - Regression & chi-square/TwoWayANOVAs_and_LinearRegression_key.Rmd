---
title: "TwoWayANOVAs_and_LinearRegression_key"
author: "N.M. Baran"
date: "2025-11-10"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This lab uses data from the Prevention of REnal and Vascular END-stage Disease (PREVEND) study. Clinical and demographic data for 4,095 individuals are stored in the PREVEND dataset in the oibiostat package. 

```{r}
library(oibiostat)
data(prevend.samp)
```

If the above code doesn't work, you need to install the oibiostat package using the following commands (minus the #)
```{r}
#install.packages("devtools")
#devtools::install_github("OI-Biostat/oi_biostat_data")
```

Suppose we are interested in whether there is difference in the effect of a history of a cardiovascular event depending on gender on the RFFT score, i.e is there an interaction between gender and cardiovascular event.

Remember that I have mentioned that t-tests and ANOVAs are just simplified versions of linear regression models? Let's prove that here...

Let's first look at how the results of a t-test, ANOVA, and linear regression compare for the effect of gender on RFFT score.

```{r}
t.test(prevend.samp$RFFT~prevend.samp$Gender, var.equal=TRUE) #Needs the var.equal=TRUE to give the results of a student t-test (the default is Welch's t-test, whcih adjusts the degrees of freedom when calculating the degrees of freedom)

model.RFFTvsGenderaov = aov(prevend.samp$RFFT~prevend.samp$Gender)
summary(model.RFFTvsGenderaov)

model.RFFTvsGender = lm(prevend.samp$RFFT~prevend.samp$Gender)
summary(model.RFFTvsGender)
```

Q: Does the p-value computed for the effect of gender differ between the different models?      

A: No! All three models give the same p-value, although some use t-statistics and some use F-statistics.

Q: Does the F-statistic computed for the effect of gender in the ANOVA differ from the F-statistic computed for the overall model in the linear regression?

A: No! Both the ANOVA and linear regression provide the same t-statistic here.

Q: What are some advantages of the linear regression model over the t-test and the ANOVA?

A: The linear regression model provides much more information, including estimates of the effect that enable us to make predictions. We can also distinguish between the significance of the overall model vs. the output of the ANOVA here just tells us about individual effects (this matters once we have more than one variable in the model!). Linear regressions can also handle categorical variables with more than 2 levels, of course. 

Ok, let's move on to the more complex model... Write the linear model that tests for an interaction between the effect of Gender and the effect of a previous cardiovascular event (CVD) on RFFT score.

A: 


Ok, let's relabel the variables to help label our data.

```{r}
prevend.samp$Gender <- factor(prevend.samp$Gender, levels = c(0,1), labels = c("Males", "Females") )
prevend.samp$CVD <- factor(prevend.samp$CVD, levels = c(0,1), labels = c("No", "Yes") )
```

Alright, let's run the model:

```{r}
model.RFFTvsGenderCVD = aov(prevend.samp$RFFT~prevend.samp$Gender * prevend.samp$CVD)
summary(model.RFFTvsGenderCVD)
```



a) Write the overall equation of the linear model. 

y = 70.1888-0.9862(Gender) -20.9388(CVD)+20.9862(Gender*CVD)

b) Now write the two (separate!) equations for males and females separately. Assume, as in the linear model, that Gender is 0 for males and 1 for females. 

Males: y = 70.1888-20.9388CVD
Females: y = 70.1888-0.9862+(-20.9388+20.9862)(CVD) = 69.2026+0.0474(CVD)

c) How do these results compare to the output of the interaction plot below?

```{r}
interaction.plot(x.factor = prevend.samp$CVD, 
                 trace.factor = prevend.samp$Gender,
                 response = prevend.samp$RFFT)
```



d) Interpretation of intercept:

The lines(!) of best of fit cross the y-axis at an RFFT score equal to 70.1888. The estimate is significant at p<0.05.

e) Interpretation of slope for Gender:

The estimate for gender is -0.9862, but it is not significant at p<0.05. If CVD is kept constant, then the RFFT score decreases by 0.9862 for females compared to males.

f) Interpretation of slope for CVD:

The estimate for the effect of a previous cardiovascular event is -20.9388 and it is significant at p<0.05. If gender is kept constant, then the RFFT score decreases by -20.9388 for individuals who have had a cardiovascular event. 

e) Interpretation of slope for Gender*CVD interaction:

The estimate of the interaction between Gender and CVD is 20.9862 and it is significant at p<0.05. This means that the effect of CVD on RFFT scores depends on the person's gender, i.e. the slopes are different between the two lines of best fit for males and females! Because of how these variables are coded, the estimate of the slope for CVD in females is 20.9862 greater than effect in males. 

f) Interpretation of R2: 

The adjusted R2 is 0.02794, meaning that this model explains only 2.794% of the variance in RFFT scores.
